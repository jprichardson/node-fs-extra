# Build steps common to all platforms

steps:
- task: NodeTool@0
  inputs:
    versionSpec: $(node_version)
  displayName: 'Install Node.js'

- script: npm install
  displayName: 'Install dependencies'

- script: npm run $(test_suite) -- -- --reporter mocha-junit-reporter --reporter-options mochaFile=./test-results.xml
  displayName: 'Run tests'

- task: PublishTestResults@2
  inputs:
    testResultsFiles: '**/test-results.xml'
    testRunTitle: $(os_name) Node $(node_version)
  displayName: 'Publishing the test results'
  condition: always()

- bash: npm run coveralls
  displayName: 'Run coveralls'
  condition: variables.run_coverage
